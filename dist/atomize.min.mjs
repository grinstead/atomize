var k={},n={},p={},r={},t={};
function u(a){return function(b){function d(f){var g=void 0===f?a.o:null===f?a.i:"boolean"===typeof f?a.g:"number"===typeof f?a.j:"string"===typeof f?a.l:"function"===typeof f?a.h:"symbol"===typeof f?a.m:f instanceof Map?a.Map:f instanceof Set?a.Set:Array.isArray(f)?a.Array:(g=Object.getPrototypeOf(f))&&g!==Object.prototype?a.instance:a.object;var J=q,K=m,L=e.length;q=f;m=x++;g(f,c)?h.set(f,0<=m?m<<1|1:-m):0>m&&h.delete(f);if(L===e.length)throw Error("Value encoded into nothing "+String(f));q=J;m=
K}function c(f,g){if(g===k)e.push(f);else if(g===n)e.push(12,f);else if(f===p)q!==k&&(0<=m&&(m=~(m<<1)),h.set(q,-m),q=k);else if(f===r)l.push(e.push(0)-1);else if(f===t)e[l.pop()]=e.length;else if(0<=m&&(m=~(m<<1),h.set(q,-1)),g=h.get(f),null!=g){if(-1===g)throw Error("infinite loop when encoding "+f);x++;e.push(0<=g?g:-g)}else d(f)}var e=[],h=new Map,l=[],x=0,m=0,q=k;d(b);return e}}function v(a){a(2,k)}function w(a){a(4,k)}function y(a,b){b(a?6:8,k)}
function z(a,b){if(a!==a)return b(10,k),!1;a===(a|0)?b(a,n):b(a,n);return!0}function A(a,b){b(p);b(14,k);b(r);for(var d=a.length,c=0;c<d;c++)b(a[c]);b(t);return!0}function B(a,b){b(a,n);return!0}function C(a,b){b(p);b(18,k);b(r);a.forEach(function(d,c){b(c)});b(t);a.forEach(function(d){b(d)});return!0}function D(a,b){b(p);b(20,k);b(r);a.forEach(function(d){b(d)});b(t);return!0}
function E(a,b){b(p);b(16,k);var d=Object.keys(a),c=d.length;b(r);for(var e=0;e<c;e++)b(d[e]);b(t);for(e=0;e<c;e++)b(a[d[e]]);return!0}function F(a,b){return a?function(d,c){c(22,k);return a(d,c)}:b}
function G(a,b,d,c){if(c&1)return a[c>>1];switch(c){case 2:break;case 4:return null;case 6:return!0;case 8:return!1;case 10:return NaN;case 12:return d();case 14:return c=[],a.push(c),H(a,c,b,d,d()),k;case 16:c={};a.push(c);var e=[];H(a,e,b,d,d());for(var h=e.length,l=0;l<h;l++)c[e[l]]=I(a,b,d);return k;case 18:c=new Map;a.push(c);e=[];H(a,e,b,d,d());h=e.length;for(l=0;l<h;l++)c.set(e[l],I(a,b,d));return k;case 20:c=new Set;a.push(c);e=[];H(a,e,b,d,d());h=e.length;for(l=0;l<h;l++)c.add(e[l]);return k;
case 22:return b(function(){return I(a,b,d)});default:throw Error("Rebuilder TODO "+c);}}function I(a,b,d){var c=a.length;b=G(a,b,d,d());if(b===k)return a[c];a.push(b);return b}function H(a,b,d,c,e){for(var h=c(e);h!==t;h=c(e)){var l=a.length;h=G(a,d,c,h);h===k?b.push(a[l]):(a.push(h),b.push(h))}};function M(a){throw Error("No way to atomize "+String(a));}function N(a,b){b(a,n);return!0}export const encodeVoid=v;export const encodeNull=w;export const encodeBoolean=y;export const encodeNumber=z;export const encodeArray=A;export const encodeString=B;export const encodeMap=C;export const encodeSet=D;export const encodeObject=E;export const AS_IS=n;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?N:M;return u({o:F(a["void"],v),i:F(a["null"],w),g:F(a["boolean"],y),j:F(a.number,z),Array:F(a.Array,A),l:F(a.string,B),Map:F(a.Map,C),Set:F(a.Set,D),object:F(a.object,E),h:F(a["function"],b),m:F(a.symbol,b),instance:F(a.instance,b)})};
export const rebuilder=function(a){return function(b){var d=0,c=b.length,e=I([],a,function(h){if(d===h)return t;if(d===c)throw Error("Incomplete data");return b[d++]});if(d!==c)throw Error("rebuilder given excess content");return e}};
