var k={},p={},q={},r={},u={};
function v(a){return function(b){function c(g){var l=void 0===g?a.o:null===g?a.i:"boolean"===typeof g?a.g:"number"===typeof g?a.j:"string"===typeof g?a.l:"function"===typeof g?a.h:"symbol"===typeof g?a.m:g instanceof Map?a.Map:g instanceof Set?a.Set:Array.isArray(g)?a.Array:(l=Object.getPrototypeOf(g))&&l!==Object.prototype?a.instance:a.object;var L=n,M=e,N=f.length;n=g;e=t;l(g,d)?0<=e&&h.set(g,~e):0>e&&h.delete(g);if(N===f.length)throw Error("Value encoded into nothing "+String(g));n=L;e=M}function d(g,
l){if(l===k)f.push(g);else if(l===p)g===(g|0)&&f.push(0),f.push(g);else if(g===q)n!==k&&(0<=e&&(e=~e),h.set(n,e),n=k);else if(g===r)m.push(f.push(0)-1);else if(g===u)f[m.pop()]=f.length;else if(0<=e&&(e=~e,h.set(n,0)),t++,l=h.get(g),null!=l){if(0===l)throw Error("infinite loop when encoding "+g);f.push(l)}else c(g)}var f=[],h=new Map,m=[],t=0,e=0,n=k;c(b);return f}}function w(a,b){b(void 0,k)}function x(a,b){b(null,k)}function y(a,b){b(a,k)}
function z(a,b){if(a===(a|0))return b(a,p),!0;b(a,k);return a===a}function A(a,b){b(q);b(1,k);b(r);for(var c=a.length,d=0;d<c;d++)b(a[d]);b(u);return!0}function B(a,b){b(a,k);return!0}function C(a,b){b(q);b(3,k);b(r);a.forEach(function(c,d){b(d)});b(u);a.forEach(function(c){b(c)});return!0}function D(a,b){b(q);b(4,k);b(r);a.forEach(function(c){b(c)});b(u);return!0}
function E(a,b){b(q);b(2,k);var c=Object.keys(a),d=c.length;b(r);for(var f=0;f<d;f++)b(c[f]);b(u);for(f=0;f<d;f++)b(a[c[f]]);return!0}function F(a,b){return a?function(c,d){d(5,k);d(r);c=a(c,d);d(u);return c}:b}
function G(a,b,c,d){if(d!==(d|0))return d;if(0>d)return a[~d];switch(d){case 0:return c();case 1:return d=[],a.push(d),H(a,d,b,c,c()),k;case 2:d={};a.push(d);var f=[];H(a,f,b,c,c());for(var h=f.length,m=0;m<h;m++)d[f[m]]=I(a,b,c);return k;case 3:d=new Map;a.push(d);f=[];H(a,f,b,c,c());h=f.length;for(m=0;m<h;m++)d.set(f[m],I(a,b,c));return k;case 4:d=new Set;a.push(d);f=[];H(a,f,b,c,c());h=f.length;for(m=0;m<h;m++)d.add(f[m]);return k;case 5:return c(),b(function(){return I(a,b,c)});default:throw Error("Rebuilder TODO "+
d);}}function I(a,b,c){var d=a.length;b=G(a,b,c,c());if(b===k)return a[d];a.push(b);return b}function H(a,b,c,d,f){for(var h=d(f);h!==u;h=d(f)){var m=a.length;h=G(a,c,d,h);h===k?b.push(a[m]):(a.push(h),b.push(h))}}function J(a,b){var c=new ArrayBuffer(8);(new DataView(c)).setFloat64(0,a);b.push(c)}function K(a,b){do{var c=a&127;a>>>=7;b.push(a?c|128:c)}while(a)};function O(a){throw Error("No way to atomize "+String(a));}function P(a,b){b(a,p);return!0}export const encodeVoid=w;export const encodeNull=x;export const encodeBoolean=y;export const encodeNumber=z;export const encodeArray=A;export const encodeString=B;export const encodeMap=C;export const encodeSet=D;export const encodeObject=E;export const AS_IS=p;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?P:O;return v({o:F(a["void"],w),i:F(a["null"],x),g:F(a["boolean"],y),j:F(a.number,z),Array:F(a.Array,A),l:F(a.string,B),Map:F(a.Map,C),Set:F(a.Set,D),object:F(a.object,E),h:F(a["function"],b),m:F(a.symbol,b),instance:F(a.instance,b)})};
export const rebuilder=function(a){return function(b){var c=0,d=b.length,f=I([],a,function(h){if(c===h)return u;if(c===d)throw Error("Incomplete data");return b[c++]});if(c!==d)throw Error("rebuilder given excess content");return f}};
export const serialize=function(a){function b(){var e=a[d++];K(e,c);switch(e){case 14:case 20:e=a[d++];for(K(e,c);d<e;)b();break;case 16:case 18:e=a[d++];K(e,c);for(var n=0;d<e;)n++,b();for(e=n;0<e;e--)b();break;case 12:e=a[d++];"number"===typeof e?e===e|0?(n=0<=e?e<<1:~e<<1|1,n>>30?J(e,c):K(n<<2,c)):J(e,c):"string"===typeof e&&(f||(f=new TextEncoder),e=f.encode(e),K(e.length<<2|3,c),c.push(e));break;case 22:for(e=a[d++];d<e;)b()}}var c=[],d=0,f=null;b();var h=c.reduce(function(e,n){return e+("number"===
typeof n?1:n.byteLength)},0),m=new Uint8Array(h),t=0;c.forEach(function(e){"number"===typeof e?m[t++]=e:(m.set(e,t),t+=e.byteLength)});return m};
