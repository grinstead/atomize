var k={},m={},n={},p={},r={};
function t(a){return function(b){function e(f){var g=void 0===f?a.o:null===f?a.i:"boolean"===typeof f?a.g:"number"===typeof f?a.j:"string"===typeof f?a.l:"function"===typeof f?a.h:"symbol"===typeof f?a.m:f instanceof Map?a.Map:f instanceof Set?a.Set:Array.isArray(f)?a.Array:(g=Object.getPrototypeOf(f))&&g!==Object.prototype?a.instance:a.object;var J=q,K=l,L=d.length;q=f;l=w++;g(f,c)?h.set(f,0<=l?l<<1|1:-l):0>l&&h.delete(f);if(L===d.length)throw Error("Value encoded into nothing "+String(f));q=J;l=
K}function c(f,g){if(g===k)d.push(f);else if(g===m)d.push(12,f);else if(f===n)q!==k&&(0<=l&&(l=~(l<<1)),h.set(q,-l),q=k);else if(f===p)x.push(d.push(0)-1);else if(f===r)d[x.pop()]=d.length;else if(0<=l&&(l=~(l<<1),h.set(f,-1)),g=h.get(f),null!=g){if(-1===g)throw Error("Infinite loop when encoding "+f);w++;d.push(0<=g?g:-g)}else e(f)}var d=[],h=new Map,x=[],w=0,l=0,q=k;e(b);return d}}function u(a){a(2,k)}function v(a){a(4,k)}function y(a,b){b(a?6:8,k)}
function z(a,b){if(a!==a)return b(10,k),!1;a===(a|0)?b(a,m):b(a,m);return!0}function A(a,b){b(n);b(14,k);b(p);for(var e=a.length,c=0;c<e;c++)b(a[c]);b(r);return!0}function B(a,b){b(a,m);return!0}function C(a,b){b(n);b(18,k);b(p);a.forEach(function(e,c){b(c)});b(r);a.forEach(function(e){b(e)});return!0}function D(a,b){b(n);b(20,k);b(p);a.forEach(function(e){b(e)});b(r);return!0}
function E(a,b){b(n);b(16,k);var e=Object.keys(a),c=e.length;b(p);for(var d=0;d<c;d++)b(e[d]);b(r);for(d=0;d<c;d++)b(a[e[d]]);return!0}function F(a,b){return a?function(e,c){c(22,k);return a(e,c)}:b}
function G(a,b,e,c){c=e(c);if(c===r)return r;if(c&1)return a[c>>1];switch(c){case 2:break;case 4:return null;case 6:return!0;case 8:return!1;case 10:return NaN;case 12:return e();case 14:c=[];for(var d=a.push(c),h=H(a,b,e,e());d<h;d++)c.push(a[d]);return k;case 16:c={};d=a.push(c);for(h=H(a,b,e,e());d<h;d++)c[a[d]]=I(a,b,e);return k;case 18:c=new Map;d=a.push(c);for(h=H(a,b,e,e());d<h;d++)c.set(a[d],I(a,b,e));return k;case 20:c=new Set;d=a.push(c);for(h=H(a,b,e,e());d<h;d++)c.add(a[d]);return k;case 22:return b(function(){return I(a,
b,e)});default:throw Error("Rebuilder TODO "+c);}}function I(a,b,e){var c=a.length;b=G(a,b,e,-1);if(b===k)return a[c];a.push(b);return b}function H(a,b,e,c){for(var d=a.length,h=k;h!==r;)h=G(a,b,e,c),h===k?d++:h!==r&&(d=a.push(h));return d};function M(a){throw Error("No way to atomize "+String(a));}function N(a,b){b(a,m);return!0}export const encodeVoid=u;export const encodeNull=v;export const encodeBoolean=y;export const encodeNumber=z;export const encodeArray=A;export const encodeString=B;export const encodeMap=C;export const encodeSet=D;export const encodeObject=E;export const AS_IS=m;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?N:M;return t({o:F(a["void"],u),i:F(a["null"],v),g:F(a["boolean"],y),j:F(a.number,z),Array:F(a.Array,A),l:F(a.string,B),Map:F(a.Map,C),Set:F(a.Set,D),object:F(a.object,E),h:F(a["function"],b),m:F(a.symbol,b),instance:F(a.instance,b)})};
export const rebuilder=function(a){return function(b){var e=0,c=b.length,d=I([],a,function(h){if(e===h)return r;if(e===c)throw Error("Incomplete data");return b[e++]});if(e!==c)throw Error("rebuilder given excess content");return d}};
