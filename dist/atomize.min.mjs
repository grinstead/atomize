var k={},m={},n={},p={},q={};
function t(a){return function(b){function c(f){var g=void 0===f?a.o:null===f?a.i:"boolean"===typeof f?a.g:"number"===typeof f?a.j:"string"===typeof f?a.l:"function"===typeof f?a.h:"symbol"===typeof f?a.m:f instanceof Map?a.Map:f instanceof Set?a.Set:Array.isArray(f)?a.Array:(g=Object.getPrototypeOf(f))&&g!==Object.prototype?a.instance:a.object;var J=r,K=l,L=e.length;r=f;l=w++;g(f,d)?h.set(f,0<=l?l<<1|1:-l):0>l&&h.delete(f);if(L===e.length)throw Error("Value encoded into nothing "+String(f));r=J;l=
K}function d(f,g){if(g===k)e.push(f);else if(g===m)e.push(12,f);else if(f===n)r!==k&&(0<=l&&(l=~(l<<1)),h.set(r,-l),r=k);else if(f===p)x.push(e.push(0)-1);else if(f===q)e[x.pop()]=e.length;else if(0<=l&&(l=~(l<<1),h.set(f,-1)),g=h.get(f),null!=g){if(-1===g)throw Error("Infinite loop when encoding "+f);w++;e.push(0<=g?g:-g)}else c(f)}var e=[],h=new Map,x=[],w=0,l=0,r=k;c(b);return e}}function u(a){a(2,k)}function v(a){a(4,k)}function y(a,b){b(a?6:8,k)}
function z(a,b){if(a!==a)return b(10,k),!1;a===(a|0)?b(a,m):b(a,m);return!0}function A(a,b){b(n);b(14,k);b(p);for(var c=a.length,d=0;d<c;d++)b(a[d]);b(q);return!0}function B(a,b){b(a,m);return!0}function C(a,b){b(n);b(18,k);b(p);a.forEach(function(c,d){b(d)});b(q);a.forEach(function(c){b(c)});return!0}function D(a,b){b(n);b(20,k);b(p);a.forEach(function(c){b(c)});b(q);return!0}
function E(a,b){b(n);b(16,k);var c=Object.keys(a),d=c.length;b(p);for(var e=0;e<d;e++)b(c[e]);b(q);for(e=0;e<d;e++)b(a[c[e]]);return!0}function F(a,b){return a?function(c,d){d(22,k);return a(c,d)}:b}
function G(a,b,c,d){d=c(d);if(d===q)return q;if(d&1)return a[d>>1];switch(d){case 2:break;case 4:return null;case 6:return!0;case 8:return!1;case 10:return NaN;case 12:return c();case 14:d=[];var e=a.push(d);b=H(a,b,c,c());for(c=e;c<b;c++)d.push(a[c]);return k;case 16:d={};var h=a.push(d);for(e=H(a,b,c,c());h<e;h++)d[a[h]]=I(a,b,c);return k;case 18:d=new Map;h=a.push(d);for(e=H(a,b,c,c());h<e;h++)d.set(a[h],I(a,b,c));return k;case 20:d=new Set;e=a.push(d);b=H(a,b,c,c());for(c=e;c<b;c++)d.add(a[c]);
return k;default:throw Error("Rebuilder TODO "+d);}}function I(a,b,c){var d=a.length;b=G(a,b,c,-1);if(b===k)return a[d];a.push(b);return b}function H(a,b,c,d){for(var e=a.length,h=k;h!==q;)h=G(a,b,c,d),h===k?e++:h!==q&&(e=a.push(h));return e};function M(a){throw Error("No way to atomize "+String(a));}function N(a,b){b(a,m);return!0}export const ALLOW_SELF_REFERENCE=n;export const encodeVoid=u;export const encodeNull=v;export const encodeBoolean=y;export const encodeNumber=z;export const encodeArray=A;export const encodeString=B;export const encodeMap=C;export const encodeSet=D;export const encodeObject=E;export const AS_IS=m;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?N:M;return t({o:F(a["void"],u),i:F(a["null"],v),g:F(a["boolean"],y),j:F(a.number,z),Array:F(a.Array,A),l:F(a.string,B),Map:F(a.Map,C),Set:F(a.Set,D),object:F(a.object,E),h:F(a["function"],b),m:F(a.symbol,b),instance:F(a.instance,b)})};
export const rebuilder=function(a){return function(b){var c=0,d=b.length,e=I([],a,function(h){if(c===h)return q;if(c===d)throw Error("Incomplete data");return b[c++]});if(c!==d)throw Error("rebuilder given excess content");return e}};
