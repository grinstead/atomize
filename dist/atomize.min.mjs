var m={},p={},q={},r={},t={};
function v(a){return function(b){function c(g){var k=void 0===g?a.o:null===g?a.i:"boolean"===typeof g?a.g:"number"===typeof g?a.j:"string"===typeof g?a.l:"function"===typeof g?a.h:"symbol"===typeof g?a.m:g instanceof Map?a.Map:g instanceof Set?a.Set:Array.isArray(g)?a.Array:(k=Object.getPrototypeOf(g))&&k!==Object.prototype?a.instance:a.object;var L=n,M=e,N=f.length;n=g;e=u++;k(g,d)?h.set(g,0<=e?e<<1|1:-e):0>e&&h.delete(g);if(N===f.length)throw Error("Value encoded into nothing "+String(g));n=L;e=
M}function d(g,k){if(k===m)f.push(g);else if(k===p)f.push(12,g);else if(g===q)n!==m&&(0<=e&&(e=~(e<<1)),h.set(n,-e),n=m);else if(g===r)l.push(f.push(0)-1);else if(g===t)f[l.pop()]=f.length;else if(0<=e&&(e=~(e<<1),h.set(n,-1)),k=h.get(g),null!=k){if(-1===k)throw Error("infinite loop when encoding "+g);u++;f.push(0<=k?k:-k)}else c(g)}var f=[],h=new Map,l=[],u=0,e=0,n=m;c(b);return f}}function w(a){a(2,m)}function x(a){a(4,m)}function y(a,b){b(a?6:8,m)}
function z(a,b){if(a!==a)return b(10,m),!1;a===(a|0)?b(a,p):b(a,p);return!0}function A(a,b){b(q);b(14,m);b(r);for(var c=a.length,d=0;d<c;d++)b(a[d]);b(t);return!0}function B(a,b){b(a,p);return!0}function C(a,b){b(q);b(18,m);b(r);a.forEach(function(c,d){b(d)});b(t);a.forEach(function(c){b(c)});return!0}function D(a,b){b(q);b(20,m);b(r);a.forEach(function(c){b(c)});b(t);return!0}
function E(a,b){b(q);b(16,m);var c=Object.keys(a),d=c.length;b(r);for(var f=0;f<d;f++)b(c[f]);b(t);for(f=0;f<d;f++)b(a[c[f]]);return!0}function F(a,b){return a?function(c,d){d(22,m);d(r);c=a(c,d);d(t);return c}:b}
function G(a,b,c,d){if(d&1)return a[d>>1];switch(d){case 2:break;case 4:return null;case 6:return!0;case 8:return!1;case 10:return NaN;case 12:return c();case 14:return d=[],a.push(d),H(a,d,b,c,c()),m;case 16:d={};a.push(d);var f=[];H(a,f,b,c,c());for(var h=f.length,l=0;l<h;l++)d[f[l]]=I(a,b,c);return m;case 18:d=new Map;a.push(d);f=[];H(a,f,b,c,c());h=f.length;for(l=0;l<h;l++)d.set(f[l],I(a,b,c));return m;case 20:d=new Set;a.push(d);f=[];H(a,f,b,c,c());h=f.length;for(l=0;l<h;l++)d.add(f[l]);return m;
case 22:return c(),b(function(){return I(a,b,c)});default:throw Error("Rebuilder TODO "+d);}}function I(a,b,c){var d=a.length;b=G(a,b,c,c());if(b===m)return a[d];a.push(b);return b}function H(a,b,c,d,f){for(var h=d(f);h!==t;h=d(f)){var l=a.length;h=G(a,c,d,h);h===m?b.push(a[l]):(a.push(h),b.push(h))}}function J(a,b){var c=new ArrayBuffer(8);(new DataView(c)).setFloat64(0,a);b.push(c)}function K(a,b){do{var c=a&127;a>>>=7;b.push(a?c|128:c)}while(a)};function O(a){throw Error("No way to atomize "+String(a));}function P(a,b){b(a,p);return!0}export const encodeVoid=w;export const encodeNull=x;export const encodeBoolean=y;export const encodeNumber=z;export const encodeArray=A;export const encodeString=B;export const encodeMap=C;export const encodeSet=D;export const encodeObject=E;export const AS_IS=p;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?P:O;return v({o:F(a["void"],w),i:F(a["null"],x),g:F(a["boolean"],y),j:F(a.number,z),Array:F(a.Array,A),l:F(a.string,B),Map:F(a.Map,C),Set:F(a.Set,D),object:F(a.object,E),h:F(a["function"],b),m:F(a.symbol,b),instance:F(a.instance,b)})};
export const rebuilder=function(a){return function(b){var c=0,d=b.length,f=I([],a,function(h){if(c===h)return t;if(c===d)throw Error("Incomplete data");return b[c++]});if(c!==d)throw Error("rebuilder given excess content");return f}};
export const serialize=function(a){function b(){var e=a[d++];K(e,c);switch(e){case 14:case 20:e=a[d++];for(K(e,c);d<e;)b();break;case 16:case 18:e=a[d++];K(e,c);for(var n=0;d<e;)n++,b();for(e=n;0<e;e--)b();break;case 12:e=a[d++];"number"===typeof e?e===e|0?(n=0<=e?e<<1:~e<<1|1,n>>30?J(e,c):K(n<<2,c)):J(e,c):"string"===typeof e&&(f||(f=new TextEncoder),e=f.encode(e),K(e.length<<2|3,c),c.push(e));break;case 22:for(e=a[d++];d<e;)b()}}var c=[],d=0,f=null;b();var h=c.reduce(function(e,n){return e+("number"===
typeof n?1:n.byteLength)},0),l=new Uint8Array(h),u=0;c.forEach(function(e){"number"===typeof e?l[u++]=e:(l.set(e,u),u+=e.byteLength)});return l};
