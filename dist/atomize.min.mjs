var n={},p={},q={},r={},u={};
function v(a){return function(b){function c(h){var k=void 0===h?a.o:null===h?a.i:"boolean"===typeof h?a.g:"number"===typeof h?a.j:"string"===typeof h?a.l:"function"===typeof h?a.h:"symbol"===typeof h?a.m:h instanceof Map?a.Map:h instanceof Set?a.Set:Array.isArray(h)?a.Array:(k=Object.getPrototypeOf(h))&&k!==Object.prototype?a.instance:a.object;var x=m,y=e,N=f.length;m=h;e=t;k(h,d)?0<=e&&g.set(h,~e):0>e&&g.delete(h);if(N===f.length)throw Error("Value encoded into nothing "+String(h));m=x;e=y}function d(h,
k){if(k===n)f.push(h);else if(k===p)h===(h|0)&&f.push(0),f.push(h);else if(k===r)l.push(f.push(h)-1);else if(k===u){k=l.pop();var x=f.length,y=x<<3|f[k];if(y>>3!==x)throw Error("value too large to encode "+String(h));f[k]=y}else if(h===q)m!==n&&(0<=e&&(e=~e),g.set(m,e),m=n);else if(0<=e&&(e=~e,g.set(m,0)),t++,k=g.get(h),null!=k){if(0===k)throw Error("infinite loop when encoding "+h);f.push(k)}else c(h)}var f=[],g=new Map,l=[],t=0,e=0,m=n;c(b);return f}}function w(a,b){b(void 0,n)}
function z(a,b){b(null,n)}function A(a,b){b(a,n)}function B(a,b){if(a===(a|0))return b(a,p),!0;b(a,n);return a===a}function C(a,b){b(q);b(1,r);for(var c=a.length,d=0;d<c;d++)b(a[d]);b(a,u);return!0}function D(a,b){b(a,n);return!0}function E(a,b){b(q);b(3,r);a.forEach(function(c,d){b(d)});b(a,u);a.forEach(function(c){b(c)});return!0}function F(a,b){b(q);b(4,r);a.forEach(function(c){b(c)});b(a,u);return!0}
function G(a,b){b(q);b(2,r);for(var c=Object.keys(a),d=c.length,f=0;f<d;f++)b(c[f]);b(a,u);for(f=0;f<d;f++)b(a[c[f]]);return!0}function H(a,b){return a?function(c,d){d(5,r);var f=a(c,d);d(c,u);return f}:b}
function I(a,b,c,d){if(d!==(d|0))return d;if(0>d)return a[~d];switch(d&7){case 0:return c();case 1:var f=[];a.push(f);J(a,f,b,c,d>>3);return n;case 2:f={};a.push(f);var g=[];J(a,g,b,c,d>>3);d=g.length;for(var l=0;l<d;l++)f[g[l]]=K(a,b,c);return n;case 3:f=new Map;a.push(f);g=[];J(a,g,b,c,d>>3);d=g.length;for(l=0;l<d;l++)f.set(g[l],K(a,b,c));return n;case 4:f=new Set;a.push(f);g=[];J(a,g,b,c,d>>3);d=g.length;for(l=0;l<d;l++)f.add(g[l]);return n;case 5:return b(function(){return K(a,b,c)});default:throw Error("Rebuilder TODO "+
d);}}function K(a,b,c){var d=a.length;b=I(a,b,c,c());if(b===n)return a[d];a.push(b);return b}function J(a,b,c,d,f){for(var g=d(f);g!==u;g=d(f)){var l=a.length;g=I(a,c,d,g);g===n?b.push(a[l]):(a.push(g),b.push(g))}}function L(a,b){var c=new ArrayBuffer(8);(new DataView(c)).setFloat64(0,a);b.push(c)}function M(a,b){do{var c=a&127;a>>>=7;b.push(a?c|128:c)}while(a)};function O(a){throw Error("No way to atomize "+String(a));}function P(a,b){b(a,p);return!0}export const encodeVoid=w;export const encodeNull=z;export const encodeBoolean=A;export const encodeNumber=B;export const encodeArray=C;export const encodeString=D;export const encodeMap=E;export const encodeSet=F;export const encodeObject=G;export const AS_IS=p;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?P:O;return v({o:H(a["void"],w),i:H(a["null"],z),g:H(a["boolean"],A),j:H(a.number,B),Array:H(a.Array,C),l:H(a.string,D),Map:H(a.Map,E),Set:H(a.Set,F),object:H(a.object,G),h:H(a["function"],b),m:H(a.symbol,b),instance:H(a.instance,b)})};
export const rebuilder=function(a){return function(b){var c=0,d=b.length,f=K([],a,function(g){if(c===g)return u;if(c===d)throw Error("Incomplete data");return b[c++]});if(c!==d)throw Error("rebuilder given excess content");return f}};
export const serialize=function(a){function b(){var e=a[d++];M(e,c);switch(e){case 14:case 20:e=a[d++];for(M(e,c);d<e;)b();break;case 16:case 18:e=a[d++];M(e,c);for(var m=0;d<e;)m++,b();for(e=m;0<e;e--)b();break;case 12:e=a[d++];"number"===typeof e?e===e|0?(m=0<=e?e<<1:~e<<1|1,m>>30?L(e,c):M(m<<2,c)):L(e,c):"string"===typeof e&&(f||(f=new TextEncoder),e=f.encode(e),M(e.length<<2|3,c),c.push(e));break;case 22:for(e=a[d++];d<e;)b()}}var c=[],d=0,f=null;b();var g=c.reduce(function(e,m){return e+("number"===
typeof m?1:m.byteLength)},0),l=new Uint8Array(g),t=0;c.forEach(function(e){"number"===typeof e?l[t++]=e:(l.set(e,t),t+=e.byteLength)});return l};
