var f={},m={},n={},p={},r={};
function t(a){return function(b){function c(g){var h=void 0===g?a.o:null===g?a.i:"boolean"===typeof g?a.g:"number"===typeof g?a.j:"string"===typeof g?a.l:"function"===typeof g?a.h:"symbol"===typeof g?a.m:g instanceof Map?a.Map:g instanceof Set?a.Set:Array.isArray(g)?a.Array:(h=Object.getPrototypeOf(g))&&h!==Object.prototype?a.instance:a.object;var J=q,K=l,L=e.length;q=g;l=w++;h(g,d)?k.set(g,0<=l?l<<1|1:-l):0>l&&k.delete(g);if(L===e.length)throw Error("Value encoded into nothing "+String(g));q=J;l=
K}function d(g,h){if(h===f)e.push(g);else if(h===m)e.push(28,g);else if(g===n)q!==f&&(0<=l&&(l=~(l<<1)),k.set(q,-l),q=f);else if(g===p)x.push(e.push(0)-1);else if(g===r)e[x.pop()]=e.length;else if(0<=l&&(l=~(l<<1),k.set(g,-1)),h=k.get(g),null!=h){if(-1===h)throw Error("Infinite loop when encoding "+g);w++;e.push(0<=h?h:-h)}else c(g)}var e=[],k=new Map,x=[],w=0,l=0,q=f;c(b);return e}}function u(a){a(2,f)}function v(a){a(4,f)}function y(a,b){b(a?6:8,f)}
function z(a,b){if(a!==a)return b(10,f),!1;a===(a|0)?(b(12,f),b(a,f)):(b(14,f),b(a,f));return!0}function A(a,b){b(n);b(16,f);b(p);for(var c=a.length,d=0;d<c;d++)b(a[d]);b(r);return!0}function B(a,b){b(18,f);b(a,f);return!0}function C(a,b){b(n);b(20,f);b(p);a.forEach(function(c,d){b(d)});b(r);a.forEach(function(c){b(c)});return!0}function D(a,b){b(n);b(22,f);b(p);a.forEach(function(c){b(c)});b(r);return!0}
function E(a,b){b(n);b(24,f);var c=Object.keys(a),d=c.length;b(p);for(var e=0;e<d;e++)b(c[e]);b(r);for(e=0;e<d;e++)b(a[c[e]]);return!0}function F(a,b){return a?function(c,d){d(26,f);return a(c,d)}:b}
function G(a,b,c,d){d=c(d);if(d===r)return r;if(d&1)return a[d>>1];switch(d){case 2:break;case 4:return null;case 6:return!0;case 8:return!1;case 10:return NaN;case 12:return c();case 14:return c();case 16:d=[];var e=a.push(d);b=H(a,b,c,c());for(c=e;c<b;c++)d.push(a[c]);return f;case 18:return c();case 20:d=new Map;var k=a.push(d);for(e=H(a,b,c,c());k<e;k++)d.set(a[k],I(a,b,c));return f;case 22:d=new Set;e=a.push(d);b=H(a,b,c,c());for(c=e;c<b;c++)d.add(a[c]);return f;case 24:d={};k=a.push(d);for(e=
H(a,b,c,c());k<e;k++)d[a[k]]=I(a,b,c);return f;default:throw Error("Rebuilder TODO "+d);}}function I(a,b,c){var d=a.length;b=G(a,b,c,-1);if(b===f)return a[d];a.push(b);return b}function H(a,b,c,d){for(var e=a.length,k=f;k!==r;)k=G(a,b,c,d),k===f?e++:k!==r&&(e=a.push(k));return e};function M(a){throw Error("No way to atomize "+String(a));}function N(a,b){b(a,m);return!0}export const ALLOW_SELF_REFERENCE=n;export const encodeVoid=u;export const encodeNull=v;export const encodeBoolean=y;export const encodeNumber=z;export const encodeArray=A;export const encodeString=B;export const encodeMap=C;export const encodeSet=D;export const encodeObject=E;export const AS_IS=m;
export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?N:M;return t({o:F(a["void"],u),i:F(a["null"],v),g:F(a["boolean"],y),j:F(a.number,z),Array:F(a.Array,A),l:F(a.string,B),Map:F(a.Map,C),Set:F(a.Set,D),object:F(a.object,E),h:F(a["function"],b),m:F(a.symbol,b),instance:F(a.instance,b)})};
export const rebuilder=function(a){return function(b){var c=0,d=b.length,e=I([],a,function(k){if(c===k)return r;if(c===d)throw Error("Incomplete data");return b[c++]});if(c!==d)throw Error("rebuilder given excess content");return e}};
