var p={},t={},v={},w={},x={};
function y(b,a){return function(g){function e(c,d){if(d===p)h.push(c);else if(d===t)c===(c|0)&&h.push(0),h.push(c);else if(d===w)l.push(h.push(c)-1);else if(d===x){d=l.pop();var f=h.length,n=f<<3|h[d];if(n>>3!==f)throw Error("value too large to encode "+String(c));h[d]=n}else if(c===v)r!==p&&(0<=m&&(m=~m),k.set(r,m),r=p);else if(0<=m&&(m=~m,k.set(r,0)),q++,d=k.get(c),null!=d){if(0===d)throw Error("infinite loop when encoding "+c);h.push(d)}else{void 0===c?d=a.o:null===c?d=a.i:"boolean"===typeof c?
d=a.g:"number"===typeof c?d=a.j:"string"===typeof c?d=a.l:"function"===typeof c?d=a.h:"symbol"===typeof c?d=a.m:c instanceof Map?d=a.Map:c instanceof Set?d=a.Set:Array.isArray(c)?d=a.Array:c instanceof ArrayBuffer||c instanceof Int8Array||c instanceof Uint8Array||c instanceof Uint8ClampedArray||c instanceof DataView?d=a.ArrayBufferView:d=(d=Object.getPrototypeOf(c))&&d!==Object.prototype?a.instance:a.object;f=r;n=m;var u=h.length;r=c;m=q;d(c,e)?0<=m&&k.set(c,~m):0>m&&k.delete(c);if(u===h.length)throw Error("Value encoded into nothing "+
String(c));r=f;m=n}}var h=[],k=new Map(b),l=[],q=k.size-1,m=0,r=p;e(g,null);return h}}function A(b,a){a(void 0,p)}function B(b,a){a(null,p)}function D(b,a){a(b,p)}function E(b,a){if(b===(b|0))return a(b,t),!0;a(b,p);return b===b}function F(b,a){a(v);a(1,w);for(var g=b.length,e=0;e<g;e++)a(b[e]);a(b,x);return!0}function G(b,a){a(b,p);return!0}function H(b,a){a(v);a(3,w);b.forEach(function(g,e){a(e)});a(b,x);b.forEach(function(g){a(g)});return!0}
function I(b,a){a(v);a(4,w);b.forEach(function(g){a(g)});a(b,x);return!0}function J(b,a){a(v);a(2,w);for(var g=Object.keys(b),e=g.length,h=0;h<e;h++)a(g[h]);a(b,x);for(h=0;h<e;h++)a(b[g[h]]);return!0}function K(b,a){a(b,p);return!0}function L(b,a){return b?function(g,e){e(5,w);var h=b(g,e);e(g,x);return h}:a}
function M(b,a,g,e){if(e!==(e|0))return e;if(0>e)return b[~e];switch(e&7){case 0:return g();case 1:var h=[];b.push(h);N(b,h,a,g,e>>3);return p;case 2:h={};b.push(h);var k=[];N(b,k,a,g,e>>3);e=k.length;for(var l=0;l<e;l++)h[k[l]]=O(b,a,g);return p;case 3:h=new Map;b.push(h);k=[];N(b,k,a,g,e>>3);e=k.length;for(l=0;l<e;l++)h.set(k[l],O(b,a,g));return p;case 4:h=new Set;b.push(h);k=[];N(b,k,a,g,e>>3);e=k.length;for(l=0;l<e;l++)h.add(k[l]);return p;case 5:return a(function(){return O(b,a,g)});default:throw Error("Rebuilder TODO "+
e);}}function O(b,a,g){var e=b.length;a=M(b,a,g,g());if(a===p)return b[e];b.push(a);return a}function N(b,a,g,e,h){for(var k=e(h);k!==x;k=e(h)){var l=b.length;k=M(b,g,e,k);k===p?a.push(b[l]):(b.push(k),a.push(k))}}
function P(b){function a(){var d=b[l++];if(0===d||d!==(d|0)){var f=0===d?b[l++]:d;if(f!==f)e(80);else if(void 0===f)e(16);else if(null===f)e(32);else if("boolean"===typeof f)e(f?48:64);else if("number"===typeof f)if(f===(f|0)){f=0<=f?f<<1:-f<<1|1;var n=127&f<<3|4;if(f>>>=4){for(d=[n|128];f;)n=f&127,f>>>=7,d.push(f?n|128:n);q+=d.length;k.push(new Uint8Array(d))}else e(n)}else n=new Uint8Array(8),(new DataView(n.buffer)).setFloat64(0,f),e(96),q+=8,k.push(n);else if("string"===typeof f)m||(m=new TextEncoder),
g(13,m.encode(f));else if(f instanceof Uint8Array)g(1,f);else if(f instanceof ArrayBuffer)e(112),g(1,new Uint8Array(f));else if(f instanceof Int8Array)e(128),g(1,f);else if(f instanceof Uint8ClampedArray)e(144),g(1,f);else if(f instanceof DataView)e(160),g(1,new Uint8Array(f.buffer,f.byteOffset,f.byteLength));else throw Error("Cannot serialize "+String(f));}else if(0>d){f=~d<<2|2;do n=f&127,f>>>=7,e(f?n|128:n);while(f)}else{var u=d&7;f=d>>3;n=h(u<<1|1);switch(u){case 1:case 4:case 5:for(;l<f;)a();
n();break;case 2:case 3:for(d=0;l<f;)d++,a();n();for(f=d;0<f;f--)a();break;default:throw Error("impossible "+d);}}}function g(d,f){d=h(d);q+=f.byteLength;k.push(f);d()}function e(d){q++;k.push(d)}function h(d){var f=k.push(0)-1,n=q;return function(){var u=q-n,z=127&u<<4|d;if(u>>>=3){for(var C=[z|128];u;)z=u&127,u>>>=7,C.push(u?z|128:z);q+=C.length;k[f]=new Uint8Array(C)}else q++,k[f]=z}}var k=[],l=0,q=0,m=null;a();var r=new Uint8Array(q),c=0;k.forEach(function(d){"number"===typeof d?r[c++]=d:(r.set(d,
c),c+=d.byteLength)});return r};function Q(b){throw Error("No way to atomize "+String(b));}function R(b,a){a(b,t);return!0}
function S(b){b=void 0===b?{}:b;var a=b.keepUnknownsAsIs?R:Q;a={o:L(b["void"],A),i:L(b["null"],B),g:L(b["boolean"],D),j:L(b.number,E),Array:L(b.Array,F),l:L(b.string,G),Map:L(b.Map,H),Set:L(b.Set,I),object:L(b.object,J),h:L(b["function"],a),m:L(b.symbol,a),instance:L(b.instance,a),ArrayBufferView:L(b.ArrayBufferView,K)};var g=[],e;null==(e=b.dictionary)||e.forEach(function(h,k){g.push([h,k])});return y(g,a)}export const AS_IS=t;export const atomizer=S;
export const rebuilder=function(b){return function(a){var g=0,e=a.length,h=O([],b,function(k){if(g===k)return x;if(g===e)throw Error("Incomplete data");return a[g++]});if(g!==e)throw Error("rebuilder given excess content");return h}};export const serializeAtoms=P;export const serializer=function(b){var a=S(b);return function(g){return P(a(g))}};
export const deserializer=function(b){var a=null;return function(g){function e(c){if(null!=m)return c=m,m=null,c;if(l===c)return x;if(l===q)throw Error("Incomplete data");c=g[l++];if(c&1)switch(c&15){case 1:c=h(c,4);c=l+c;var d=g.subarray(l,c);l=c;return d;case 13:return c=h(c,4),c=l+c,d=g.subarray(l,c),l=c,a||(a=new TextDecoder),a.decode(d);default:return d=h(c,4),l+d<<3|7&c>>1}else{if(c&2)return~h(c,2);if(c&4)return c=h(c,3),m=c&1?-(c>>>1):c>>>1,0;switch(c){case 16:break;case 32:return null;case 48:return!0;
case 64:return!1;case 80:return NaN;case 96:return k||(k=new DataView(g.buffer,g.byteOffset,g.byteLength)),c=k.getFloat64(l),l+=8,c;case 112:return c=e(),d=c.byteOffset,c.buffer.slice(d,d+c.byteLength);case 128:case 144:case 160:return d=e(),new (128===c?Int8Array:160===c?DataView:Uint8ClampedArray)(d.buffer,d.byteOffset,d.byteLength);default:throw Error("bad byte "+c);}}}function h(c,d){var f=7-d;for(d=(127&c)>>d;c&128;)c=g[l++],d|=(c&127)<<f,f+=7;return d}var k=null,l=0,q=g.length,m=null,r=O([],
b,e);if(l!==q)throw Error("deserializer given excess content");return r}};
