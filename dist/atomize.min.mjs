var p={},t={},u={},v={},w={};
function y(a){return function(b){function e(d){var c=void 0===d?a.o:null===d?a.i:"boolean"===typeof d?a.g:"number"===typeof d?a.j:"string"===typeof d?a.l:"function"===typeof d?a.h:"symbol"===typeof d?a.m:d instanceof Map?a.Map:d instanceof Set?a.Set:Array.isArray(d)?a.Array:(c=Object.getPrototypeOf(d))&&c!==Object.prototype?a.instance:a.object;var l=q,r=n,x=f.length;q=d;n=k;c(d,g)?0<=n&&h.set(d,~n):0>n&&h.delete(d);if(x===f.length)throw Error("Value encoded into nothing "+String(d));q=l;n=r}function g(d,
c){if(c===p)f.push(d);else if(c===t)d===(d|0)&&f.push(0),f.push(d);else if(c===v)m.push(f.push(d)-1);else if(c===w){c=m.pop();var l=f.length,r=l<<3|f[c];if(r>>3!==l)throw Error("value too large to encode "+String(d));f[c]=r}else if(d===u)q!==p&&(0<=n&&(n=~n),h.set(q,n),q=p);else if(0<=n&&(n=~n,h.set(q,0)),k++,c=h.get(d),null!=c){if(0===c)throw Error("infinite loop when encoding "+d);f.push(c)}else e(d)}var f=[],h=new Map,m=[],k=0,n=0,q=p;e(b);return f}}function z(a,b){b(void 0,p)}
function A(a,b){b(null,p)}function B(a,b){b(a,p)}function C(a,b){if(a===(a|0))return b(a,t),!0;b(a,p);return a===a}function D(a,b){b(u);b(1,v);for(var e=a.length,g=0;g<e;g++)b(a[g]);b(a,w);return!0}function E(a,b){b(a,p);return!0}function F(a,b){b(u);b(3,v);a.forEach(function(e,g){b(g)});b(a,w);a.forEach(function(e){b(e)});return!0}function G(a,b){b(u);b(4,v);a.forEach(function(e){b(e)});b(a,w);return!0}
function H(a,b){b(u);b(2,v);for(var e=Object.keys(a),g=e.length,f=0;f<g;f++)b(e[f]);b(a,w);for(f=0;f<g;f++)b(a[e[f]]);return!0}function I(a,b){return a?function(e,g){g(5,v);var f=a(e,g);g(e,w);return f}:b}
function J(a,b,e,g){if(g!==(g|0))return g;if(0>g)return a[~g];switch(g&7){case 0:return e();case 1:var f=[];a.push(f);K(a,f,b,e,g>>3);return p;case 2:f={};a.push(f);var h=[];K(a,h,b,e,g>>3);g=h.length;for(var m=0;m<g;m++)f[h[m]]=L(a,b,e);return p;case 3:f=new Map;a.push(f);h=[];K(a,h,b,e,g>>3);g=h.length;for(m=0;m<g;m++)f.set(h[m],L(a,b,e));return p;case 4:f=new Set;a.push(f);h=[];K(a,h,b,e,g>>3);g=h.length;for(m=0;m<g;m++)f.add(h[m]);return p;case 5:return b(function(){return L(a,b,e)});default:throw Error("Rebuilder TODO "+
g);}}function L(a,b,e){var g=a.length;b=J(a,b,e,e());if(b===p)return a[g];a.push(b);return b}function K(a,b,e,g,f){for(var h=g(f);h!==w;h=g(f)){var m=a.length;h=J(a,e,g,h);h===p?b.push(a[m]):(a.push(h),b.push(h))}};function M(a){throw Error("No way to atomize "+String(a));}function N(a,b){b(a,t);return!0}export const AS_IS=t;export const atomizer=function(a){a=void 0===a?{}:a;var b=a.keepUnknownsAsIs?N:M;return y({o:I(a["void"],z),i:I(a["null"],A),g:I(a["boolean"],B),j:I(a.number,C),Array:I(a.Array,D),l:I(a.string,E),Map:I(a.Map,F),Set:I(a.Set,G),object:I(a.object,H),h:I(a["function"],b),m:I(a.symbol,b),instance:I(a.instance,b)})};
export const rebuilder=function(a){return function(b){var e=0,g=b.length,f=L([],a,function(h){if(e===h)return w;if(e===g)throw Error("Incomplete data");return b[e++]});if(e!==g)throw Error("rebuilder given excess content");return f}};
export const serialize=function(a){function b(){var d=a[h++];if(0===d||d!==(d|0)){var c=0===d?a[h++]:d;if(c!==c)e(80);else if(void 0===c)e(16);else if(null===c)e(32);else if("boolean"===typeof c)e(c?48:64);else if("number"===typeof c)if(c===(c|0)){c=0<=c?c<<1:-c<<1|1;var l=127&c<<3|4;if(c>>>=4){for(d=[l|128];c;)l=c&127,c>>>=7,d.push(c?l|128:l);m+=d.length;f.push(new Uint8Array(d))}else e(l)}else l=new Uint8Array(8),(new DataView(l.buffer)).setFloat64(0,c),e(96),m+=8,f.push(l);else"string"===typeof c?
(k||(k=new TextEncoder),l=g(13),c=k.encode(c),m+=c.byteLength,f.push(c),l()):console.error("TODO serialize "+String(c))}else if(0>d){c=~d<<2|2;do l=c&127,c>>>=7,e(c?l|128:l);while(c)}else{var r=d&7;c=d>>3;l=g(r<<1|1);switch(r){case 1:case 4:case 5:for(;h<c;)b();l();break;case 2:case 3:for(d=0;h<c;)d++,b();l();for(c=d;0<c;c--)b();break;default:throw Error("impossible "+d);}}}function e(d){m++;f.push(d)}function g(d){var c=f.push(0)-1;return function(){var l=m,r=127&l<<4|d;if(l>>>=3){for(var x=[r|128];l;)r=
l&127,l>>>=7,x.push(l?r|128:r);m+=x.length;f[c]=new Uint8Array(x)}else m++,f[c]=r}}var f=[],h=0,m=0,k=null;b();var n=new Uint8Array(m),q=0;f.forEach(function(d){"number"===typeof d?n[q++]=d:(n.set(d,q),q+=d.byteLength)});return n};
export const deserializer=function(a){var b=null;return function(e){function g(k,n){k>>=n;n=7-n;for(var q=127&k;k&128;)k=e[h++],q|=(k&127)<<n,n+=7;return q}var f=null,h=0,m=e.length;return L([],a,function(k){if(h===k)return w;if(h===m)throw Error("Incomplete data");k=e[h++];if(k&1)switch(k&15){case 13:k=g(k,4);var n=e.subarray(h,k);h=k;b||(b=new TextDecoder);return b.decode(n);default:return g(k,3)}else{if(k&2)return~g(k,2);if(k&4)return k=g(k,3),k&1?-(k>>>1):k>>>1;switch(k){case 16:break;case 32:return null;
case 48:return!0;case 64:return!1;case 80:return NaN;case 96:return f||(f=new DataView(e.buffer,e.byteOffset,e.byteLength)),k=f.getFloat64(h),h+=8,k;default:throw Error("bad byte "+k);}}})}};
